(function(n,t){Croppic=function(n,t){var r=this;r.id=n;r.obj=$("#"+n);r.outputDiv=r.obj;r.options={getUrl:"",uploadUrl:"",uploadFallbackUrl:"",uploadData:{},cropUrl:"",cropData:{},outputUrlId:"",imgEyecandy:!0,imgEyecandyOpacity:.2,zoomFactor:10,initialZoom:40,doubleZoomControls:!0,modal:!1,customUploadButtonId:"",loaderHtml:"",onBeforeImgUpload:null,onAfterImgUpload:null,onImgDrag:null,onImgZoom:null,onBeforeImgCrop:null,onAfterImgCrop:null};for(i in t)r.options[i]=t[i];r.init(!0)};Croppic.prototype={id:"",imgInitW:0,imgInitH:0,imgW:0,imgH:0,objW:0,objH:0,windowW:0,windowH:$(n).height(),obj:{},outputDiv:{},outputUrlObj:{},img:{},defaultImg:{},croppedImg:{},imgEyecandy:{},form:{},iframeform:{},iframeobj:{},cropControlsUpload:{},cropControlsCrop:{},cropControlZoomMuchIn:{},cropControlZoomMuchOut:{},cropControlZoomIn:{},cropControlZoomOut:{},cropControlCrop:{},cropControlReset:{},cropControlRemoveCroppedImage:{},modal:{},loader:{},preloadexisting:function(n,t){var i=this;n==!0?$.ajax({url:i.options.getUrl,type:"GET"}).always(function(n){n[0]=="Success"&&$("<img src='"+n[1]+"' width='"+n[2]+"' height='"+n[3]+"' class='"+n[4]+"' alt=''/>").appendTo("#croppic");typeof t=="function"&&t()}):typeof t=="function"&&t()},init:function(n){var t=this;t.preloadexisting(n,function(){t.objW=t.obj.width();t.objH=t.obj.height();$.isEmptyObject(t.defaultImg)&&(t.defaultImg=t.obj.find("img"));t.defaultImg.hasClass("tocrop")?(t.imgInitW=t.imgW=parseFloat(t.defaultImg.attr("width")),t.imgInitH=t.imgH=parseFloat(t.defaultImg.attr("height")),t.options.modal&&t.createModal(),t.obj.append('<img src="'+t.defaultImg.attr("src")+'">'),t.defaultImg.remove(),t.defaultImg={},t.initCropper()):(t.createImgUploadControls(),t.bindImgUploadControl())})},createImgUploadControls:function(){var n=this,t="",i,r;n.options.customUploadButtonId===""&&(t='<i class="cropControlUpload"><\/i>');i='<i class="cropControlRemoveCroppedImage"><\/i>';$.isEmptyObject(n.croppedImg)&&(i="");r='<div class="cropControls cropControlsUpload"> '+t+" <\/div>";n.outputDiv.append(r);n.cropControlsUpload=n.outputDiv.find(".cropControlsUpload");n.options.customUploadButtonId===""?n.imgUploadControl=n.outputDiv.find(".cropControlUpload"):(n.imgUploadControl=$("#"+n.options.customUploadButtonId),n.imgUploadControl.show())},bindImgUploadControl:function(){var n=this,r='<form class="'+n.id+'_imgUploadForm" style="display: none; visibility: hidden;">  <input type="file" name="img" id="'+n.id+'_imgUploadField">  <\/form>',i;n.outputDiv.append(r);n.form=n.outputDiv.find("."+n.id+"_imgUploadForm");i=n.CreateFallbackIframe();n.imgUploadControl.off("click");n.imgUploadControl.on("click",function(){i===""?n.form.find('input[type="file"]').trigger("click"):n.iframeform.find('input[type="file"]').trigger("click")});n.form.find('input[type="file"]').change(function(){var i,r;n.options.onBeforeImgUpload&&n.options.onBeforeImgUpload.call(n);n.showLoader();n.imgUploadControl.hide();i=new FormData;i.append("file",n.form.find("input[type=file]")[0].files[0]);for(r in n.options.uploadData)n.options.uploadData.hasOwnProperty(r)&&i.append(r,n.options.uploadData[r]);$.ajax({url:n.options.uploadUrl,data:i,context:t.body,cache:!1,contentType:!1,processData:!1,type:"POST"}).always(function(t){n.afterUpload(t)})})},afterUpload:function(n){var t=this;n[0]=="Success"&&(t.imgInitW=t.imgW=n[2],t.imgInitH=t.imgH=n[3],t.options.modal&&t.createModal(),$.isEmptyObject(t.croppedImg)||t.croppedImg.remove(),t.imgUrl=n[1],t.obj.append('<img src="'+n[1]+'">'),t.initCropper(),t.hideLoader(),t.options.onAfterImgUpload&&t.options.onAfterImgUpload.call(t));n[0]=="Error"&&(t.obj.append('<p style="width:100%; height:100%; text-align:center; line-height:'+t.objH+'px;">'+n[1]+"<\/p>"),t.hideLoader(),setTimeout(function(){t.reset()},2e3))},createModal:function(){var n=this,t=n.windowH/2-n.objH/2,i='<div id="croppicModal"><div id="croppicModalObj" style="width:'+n.objW+"px; height:"+n.objH+"px; margin:0 auto; margin-top:"+t+'px; position: relative;"> <\/div><\/div>';$("body").append(i);n.modal=$("#croppicModal");n.obj=$("#croppicModalObj")},destroyModal:function(){var n=this;n.obj=n.outputDiv;n.modal.remove();n.modal={}},initCropper:function(){var n=this;n.img=n.obj.find("img");n.img.wrap('<div class="cropImgWrapper" style="overflow:hidden; z-index:1; position:absolute; width:'+n.objW+"px; height:"+n.objH+'px;"><\/div>');n.createCropControls();n.options.imgEyecandy&&n.createEyecandy();n.initDrag();n.initialScaleImg()},createEyecandy:function(){var n=this;n.imgEyecandy=n.img.clone();n.imgEyecandy.css({"z-index":"0",opacity:n.options.imgEyecandyOpacity}).appendTo(n.obj)},destroyEyecandy:function(){var n=this;n.imgEyecandy.remove()},initialScaleImg:function(){var n=this;n.zoom(-n.imgInitW);n.zoom(n.options.initialZoom);n.img.css({left:-(n.imgW-n.objW)/2,top:-(n.imgH-n.objH)/2,position:"relative"});n.options.imgEyecandy&&n.imgEyecandy.css({left:-(n.imgW-n.objW)/2,top:-(n.imgH-n.objH)/2,position:"relative"})},createCropControls:function(){var n=this,t='<i class="cropControlZoomIn"><\/i>',i='<i class="cropControlZoomOut"><\/i>',r='<i class="cropControlCrop"><\/i>',u;if(u=n.options.doubleZoomControls?'<div class="cropControls cropControlsCrop"><i class="cropControlZoomMuchIn"><\/i>'+t+i+'<i class="cropControlZoomMuchOut"><\/i>'+r+"<\/div>":'<div class="cropControls cropControlsCrop">'+t+i+r+"<\/div>",n.obj.append(u),n.cropControlsCrop=n.obj.find(".cropControlsCrop"),n.options.doubleZoomControls){n.cropControlZoomMuchIn=n.cropControlsCrop.find(".cropControlZoomMuchIn");n.cropControlZoomMuchIn.on("click",function(){n.zoom(n.options.zoomFactor*10)});n.cropControlZoomMuchOut=n.cropControlsCrop.find(".cropControlZoomMuchOut");n.cropControlZoomMuchOut.on("click",function(){n.zoom(-n.options.zoomFactor*10)})}n.cropControlZoomIn=n.cropControlsCrop.find(".cropControlZoomIn");n.cropControlZoomIn.on("click",function(){n.zoom(n.options.zoomFactor)});n.cropControlZoomOut=n.cropControlsCrop.find(".cropControlZoomOut");n.cropControlZoomOut.on("click",function(){n.zoom(-n.options.zoomFactor)});n.cropControlCrop=n.cropControlsCrop.find(".cropControlCrop");n.cropControlCrop.on("click",function(){n.crop()})},initDrag:function(){var n=this;n.img.on("mousedown",function(t){t.preventDefault();var u=n.img.css("z-index"),i=n.img.outerHeight(),r=n.img.outerWidth(),f=n.img.offset().top+i-t.pageY,e=n.img.offset().left+r-t.pageX;n.img.css("z-index",1e3).on("mousemove",function(t){var h=t.pageY+f-i,c=t.pageX+e-r,o,s;n.img.offset({top:h,left:c}).on("mouseup",function(){$(this).removeClass("draggable").css("z-index",u)});n.options.imgEyecandy&&n.imgEyecandy.offset({top:h,left:c});parseInt(n.img.css("top"))>0&&(n.img.css("top",0),n.options.imgEyecandy&&n.imgEyecandy.css("top",0));o=-(n.imgH-n.objH);parseInt(n.img.css("top"))<o&&(n.img.css("top",o),n.options.imgEyecandy&&n.imgEyecandy.css("top",o));parseInt(n.img.css("left"))>0&&(n.img.css("left",0),n.options.imgEyecandy&&n.imgEyecandy.css("left",0));s=-(n.imgW-n.objW);parseInt(n.img.css("left"))<s&&(n.img.css("left",s),n.options.imgEyecandy&&n.imgEyecandy.css("left",s));n.options.onImgDrag&&n.options.onImgDrag.call(n)})}).on("mouseup",function(){n.img.off("mousemove")}).on("mouseout",function(){n.img.off("mousemove")})},zoom:function(n){var t=this,e=t.imgW/t.imgH,i=t.imgW+n,r=i/e,o=!0,u,f,s,h;(i<t.objW||r<t.objH)&&(i-t.objW<r-t.objH?(i=t.objW,r=i/e):(r=t.objH,i=e*r),o=!1);(i>t.imgInitW||r>t.imgInitH)&&(i-t.imgInitW<r-t.imgInitH?(i=t.imgInitW,r=i/e):(r=t.imgInitH,i=e*r),o=!1);t.imgW=i;t.img.width(i);t.imgH=r;t.img.height(r);u=parseInt(t.img.css("top"))-n/2;f=parseInt(t.img.css("left"))-n/2;u>0&&(u=0);f>0&&(f=0);s=-(r-t.objH);u<s&&(u=s);h=-(i-t.objW);f<h&&(f=h);o&&t.img.css({top:u,left:f});t.options.imgEyecandy&&(t.imgEyecandy.width(i),t.imgEyecandy.height(r),o&&t.imgEyecandy.css({top:u,left:f}));t.options.onImgZoom&&t.options.onImgZoom.call(t)},crop:function(){var n=this,r,u,i;n.imgEyecandy=n.img.clone();n.options.onBeforeImgCrop&&n.options.onBeforeImgCrop.call(n);n.cropControlsCrop.hide();n.showLoader();r={imgUrl:n.imgUrl,imgInitW:n.imgInitW,imgInitH:n.imgInitH,imgW:n.imgW,imgH:n.imgH,imgY1:Math.abs(parseInt(n.img.css("top"))),imgX1:Math.abs(parseInt(n.img.css("left"))),cropH:n.objH,cropW:n.objW};u="";for(i in r)r.hasOwnProperty(i)&&(u+="&"+i+"="+r[i]);for(i in n.options.cropData)n.options.cropData.hasOwnProperty(i)&&(u+="&"+i+"="+n.options.cropData[i]);$.ajax({url:n.options.cropUrl+"?"+u.substring(1),context:t.body,cache:!1,contentType:!1,processData:!1,type:"GET"}).always(function(t){n.afterCrop(t)})},afterCrop:function(n){var t=this;n[0]=="Success"&&(t.imgEyecandy.hide(),t.destroy(),t.obj.append('<img class="croppedImg" src="'+n[1]+'">'),t.options.outputUrlId!==""&&$("#"+t.options.outputUrlId).val(n[1]),t.croppedImg=t.obj.find(".croppedImg"),t.init(!1),t.hideLoader());n[0]=="Error"&&t.obj.append('<p style="width:100%; height:100%;>'+n[1]+'<\/p>">');t.options.onAfterImgCrop&&t.options.onAfterImgCrop.call(t)},showLoader:function(){var n=this;n.obj.append(n.options.loaderHtml);n.loader=n.obj.find(".loader")},hideLoader:function(){var n=this;n.loader.remove()},reset:function(){var n=this;n.destroy();n.init(!1);$.isEmptyObject(n.croppedImg)||(n.obj.append(n.croppedImg),n.options.outputUrlId!==""&&$("#"+n.options.outputUrlId).val(n.croppedImg.attr("url")))},destroy:function(){var n=this;n.options.modal&&!$.isEmptyObject(n.modal)&&n.destroyModal();n.options.imgEyecandy&&!$.isEmptyObject(n.imgEyecandy)&&n.destroyEyecandy();$.isEmptyObject(n.cropControlsUpload)||n.cropControlsUpload.remove();$.isEmptyObject(n.cropControlsCrop)||n.cropControlsCrop.remove();$.isEmptyObject(n.loader)||n.loader.remove();$.isEmptyObject(n.form)||n.form.remove();n.obj.html("")},isAjaxUploadSupported:function(){var n=t.createElement("input");return n.type="file","multiple"in n&&typeof File!="undefined"&&typeof FormData!="undefined"&&typeof(new XMLHttpRequest).upload!="undefined"},CreateFallbackIframe:function(){var n=this,i,u,r;if(n.isAjaxUploadSupported())return"";jQuery.isEmptyObject(n.iframeobj)?(i=t.createElement("iframe"),i.setAttribute("id",n.id+"_upload_iframe"),i.setAttribute("name",n.id+"_upload_iframe"),i.setAttribute("width","0"),i.setAttribute("height","0"),i.setAttribute("border","0"),i.setAttribute("src","javascript:false;"),i.style.display="none",t.body.appendChild(i)):i=n.iframeobj[0];u='<!DOCTYPE html><html><head><title>Uploading File<\/title><\/head><body><form class="'+n.id+'_upload_iframe_form" name="'+n.id+'_upload_iframe_form" action="'+n.options.uploadFallbackUrl+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" style="display:none;">'+$("#"+n.id+"_imgUploadField")[0].outerHTML+"<\/form><\/body><\/html>";i.contentWindow.document.open("text/htmlreplace");i.contentWindow.document.write(u);i.contentWindow.document.close();n.iframeobj=$("#"+n.id+"_upload_iframe");n.iframeform=n.iframeobj.contents().find("html").find("."+n.id+"_upload_iframe_form");n.iframeform.on("change","input",function(){n.SubmitFallbackIframe(n)});return n.iframeform.find("input")[0].attachEvent("onchange",function(){n.SubmitFallbackIframe(n)}),r=function(){i.detachEvent?i.detachEvent("onload",r):i.removeEventListener("load",r,!1);var t=n.getIframeContentJSON(i);jQuery.isEmptyObject(n.modal)&&n.afterUpload(t)},i.addEventListener&&i.addEventListener("load",r,!0),i.attachEvent&&i.attachEvent("onload",r),"#"+n.id+"_imgUploadField"},SubmitFallbackIframe:function(n){n.showLoader();n.iframeform[0].submit()},getIframeContentJSON:function(n){try{var r=n.contentDocument?n.contentDocument:n.contentWindow.document,i,t=r.body.innerHTML;t.slice(0,5).toLowerCase()=="<pre>"&&t.slice(-6).toLowerCase()=="<\/pre>"&&(t=r.body.firstChild.firstChild.nodeValue);i=jQuery.parseJSON(t)}catch(u){i={success:!1}}return i}}})(window,document);
/*
//# sourceMappingURL=croppic.min.js.map
*/